<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>moq.ts documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="./images/favicon.ico">
	      <link rel="stylesheet" href="./styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="./" class="navbar-brand">moq.ts documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search">
</div>
            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content getting-started">
                   <div class="content-data">

<p><a href="https://travis-ci.org/dvabuzyarov/moq.ts"><img src="https://travis-ci.org/dvabuzyarov/moq.ts.svg?branch=master" alt="Build Status" class="img-responsive"></a>
<a href="https://www.npmjs.com/package/moq.ts"><img src="http://img.shields.io/npm/v/moq.ts.svg?style=flat-square" alt="NPM version" class="img-responsive"></a>
<a href="https://www.npmjs.com/package/moq.ts"><img src="https://img.shields.io/npm/dt/moq.ts.svg?style=flat-square" alt="npm downloads" class="img-responsive"></a>
<a href="https://david-dm.org/dvabuzyarov/moq.ts"><img src="http://img.shields.io/david/dvabuzyarov/moq.ts.svg?style=flat-square" alt="Dependency Status" class="img-responsive"></a>
<a href="https://www.npmjs.com/package/moq.ts"><img src="https://img.shields.io/hexpm/l/plug.svg" alt="License" class="img-responsive"></a></p>
<h1 id="moq-ts">moq.ts</h1>
<p>Moq for Typescript. Inspired by c# <a href="https://github.com/moq/moq4">Moq library</a>.</p>
<h4 id="documentation-https-dvabuzyarov-github-io-moq-ts-"><a href="https://dvabuzyarov.github.io/moq.ts/">Documentation https://dvabuzyarov.github.io/moq.ts/</a></h4>
<h4 id="important">Important</h4>
<p>This implementation depends on <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a> object.
So if your production code is not compatible with this I would recommend you separate you production code and testing code into dedicated projects.
If you need help with this then ask me.</p>
<h4 id="install">Install</h4>
<p>npm install moq.ts --save-dev</p>
<h4 id="quick-start">Quick start</h4>
<p>moq.ts as the original <a href="https://github.com/moq/moq4">Moq library</a> is intended to be simple to use, strongly typed (no magic strings!, and therefore full compiler-verified and refactoring-friendly) and minimalistic (while still fully functional!).</p>
<p>You can find a pretty full set of usages in the integration tests. Check out <a href="https://github.com/dvabuzyarov/moq.ts/tree/master/tests.integration">tests.integration</a> folder.</p>
<p>Mocking property of objects
-
<a href="https://github.com/dvabuzyarov/moq.ts/blob/master/tests.integration/mock-get.property.IntegrationTests.ts">mock-get.property.IntegrationTests.ts</a></p>
<div><pre class="line-numbers"><code class="language-typescript">import {Mock, It, Times, ExpectedGetPropertyExpression} from &#39;moq.ts&#39;;
interface ITestObject {
    property1: number;
    property2: number;
    property3: number;
    property4: number;
    method(): void;
}

const property4Name = &#39;property4&#39;;
const mockName = &#39;mock name is optional&#39;;
const mock = new Mock&lt;ITestObject&gt;(mockName)
    .setup(instance =&gt; instance.property1)
    .returns(1)

    .setup(instance =&gt; It.Is((expression: ExpectedGetPropertyExpression) =&gt; expression.name === &#39;property2&#39;))
    .returns(100)

    //let&#39;s deny any write operation on the property for all values
    .setup(instance =&gt; {instance.property2 = It.Is(() =&gt; true)})
    .returns(false)

    .setup(instance =&gt; instance.property3)
    .callback(()=&gt; 10 + 10)

    .setup(instance =&gt; instance[property4Name])
    .throws(new Error(&#39;property4 access&#39;))

    //since a method is a property that holds a pointer to a function
    .setup(instance =&gt; instance.method)
    .returns(()=&gt;{console.log(&#39;The method was called&#39;)});

const object = mock.object();
object.method();

mock.verify(instance=&gt; instance.property1, Times.Never());</code></pre></div><p>Mocking property setting
-
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler/set">The documentation on returned value from &#39;set hook&#39; on Proxy object</a></p>
<p><a href="https://github.com/dvabuzyarov/moq.ts/blob/master/tests.integration/mock-set.property.IntegrationTests.ts">mock-set.property.IntegrationTests.ts</a></p>
<div><pre class="line-numbers"><code class="language-typescript">import {Mock, It, Times, ExpectedSetPropertyExpression} from &#39;moq.ts&#39;;
interface ITestObject {
    property: number|any;
}

const value = {field: new Date()};

const mock = new Mock&lt;ITestObject&gt;()
    .setup(instance =&gt; {instance.property = 1})
    //true - allows the write operation
    .returns(true)

    .setup(instance =&gt; It.Is((expression: ExpectedSetPropertyExpression) =&gt; expression.name === &#39;property&#39; &amp;&amp; expression.value === 2))
    //false - denies the write operation
    .returns(false)

    .setup(instance =&gt; {instance.property = It.Is(value =&gt; value === 3)})
    // allows the write operation
    .callback(()=&gt; true)

    .setup(instance =&gt; {instance.property = value})
    .throws(new Error(&#39;an object has been written into property&#39;));


const object = mock.object();
object.property = 1;

mock.verify(instance=&gt; {instance.property = 1}, Times.Once());</code></pre></div><p>Mocking functions
-</p>
<p><a href="https://github.com/dvabuzyarov/moq.ts/blob/master/tests.integration/mock-method.IntegrationTests.ts">mock-method.property.IntegrationTests.ts</a></p>
<div><pre class="line-numbers"><code class="language-typescript">import {Mock, It, Times} from &#39;moq.ts&#39;;
interface ITestFunction {
    (arg: number|any): string;
}

const value = {field: new Date()};

const mock = new Mock&lt;ITestFunction&gt;()
    .setup(instance =&gt; instance(1))
    .returns(&#39;called with 1&#39;)

    .setup(instance =&gt; instance(2))
    .callback((argument)=&gt; argument === 2 ? &#39;called with 2&#39; : `called with ${argument}`)

    .setup(instance =&gt; instance(value))
    .throws(new Error(&#39;Argument is object with date&#39;))

    .setup(instance =&gt; instance(It.Is(value =&gt; value === 4)))
    .returns(&#39;called with 4&#39;);

const method = mock.object();
const actual = method(1);

mock.verify(instance =&gt; instance(1), Times.Once());
mock.verify(instance =&gt; instance(It.Is(value=&gt; value === 1)), Times.Exactly(1));

</code></pre></div><p> Mocking functions of objects
 -
<a href="https://github.com/dvabuzyarov/moq.ts/blob/master/tests.integration/mock-named.method.IntegrationTests.ts">mock-named.method.IntegrationTests.ts</a></p>
<div><pre class="line-numbers"><code class="language-typescript">import {Mock, It, Times} from &#39;moq.ts&#39;;
interface ITestObject {
    method(arg1: number, arg2: string): Date;
}

const values = [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;];

const mock = new Mock&lt;ITestObject&gt;()
    .setup(instance =&gt; instance.method(1, values[0]))
    .returns(new Date(2016))

    .setup(instance =&gt; instance.method(It.Is(value =&gt; value === 2), values[1]))
    .callback((arg1, arg2)=&gt; new Date(2017 + arg1))

    .setup(instance =&gt; instance.method(3, It.Is(value =&gt; value === values[2])))
    .throws(new Error(&#39;Invoking method with 3 and c&#39;));

const object = mock.object();
const actual = object.method(1, &#39;a&#39;);

mock.verify(instance =&gt; instance.method(2, &#39;a&#39;), Times.Never());</code></pre></div><h2 id="mock-behavior">Mock behavior</h2>
<p>You can control mock behavior when accessing to a property without a corresponding setup. </p>
<div><pre class="line-numbers"><code class="language-typescript">    mock = new Mock&lt;ITestObject&gt;()
    .setBehaviorStrategy(MockBehavior.Loose)
    //or
    .setBehaviorStrategy(MockBehavior.Strict);</code></pre></div><p>The default behavior is strict.</p>
<h5 id="mockbehavior-strict">MockBehavior.Strict</h5>
<p>Accessing to an unset property will return undefined value;
Accessing to an unset method of an object will throw TypeError exception; It does not matter if a method is a part of mocked type.
If you want to track a method you can define a default setup:</p>
<div><pre class="line-numbers"><code class="language-typescript">const mock = new Mock&lt;ITestObject&gt;()
    .setup(instance =&gt; instance.method(It.Is(()=&gt;true), It.Is(()=&gt;true)))
    .returns(undefined);</code></pre></div><h5 id="mockbehavior-loose">MockBehavior.Loose</h5>
<p>Accessing to an unset property or a method will return a pointer to a spy function;
You can call this function and it will be tracked.</p>
<h2 id="mock-prototype">Mock prototype</h2>
<p>If you need to make work instanceof operator or you need to deal with prototype of the mock object you can 
use prototypeof function of Mock class. Or you can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getPrototypeOf">Object.getPrototypeOf</a> or <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf">Object.setPrototypeOf</a> functions
on mock object.</p>
<div><pre class="line-numbers"><code class="language-typescript">class TestObject implements ITestObject {

}

const mock = new Mock&lt;ITestObject&gt;()
                .prototypeof(TestObject)
                .object();

mock.object() instanceof TestObject;// true</code></pre></div><p>Sponsored by <a href="https://www.2bit.ch">2BIT</a></p>


















                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 0;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'getting-started';
            var COMPODOC_CURRENT_PAGE_URL = 'index.html';
       </script>

       <script src="./js/libs/custom-elements.min.js"></script>
       <script src="./js/libs/lit-html.js"></script>
       <script src="./js/menu-wc.js"></script>

       <script src="./js/libs/bootstrap-native.js"></script>

       <script src="./js/libs/es6-shim.min.js"></script>
       <script src="./js/libs/EventDispatcher.js"></script>
       <script src="./js/libs/promise.min.js"></script>
       <script src="./js/libs/zepto.min.js"></script>

       <script src="./js/compodoc.js"></script>

       <script src="./js/tabs.js"></script>
       <script src="./js/menu.js"></script>
       <script src="./js/libs/clipboard.min.js"></script>
       <script src="./js/libs/prism.js"></script>
       <script src="./js/sourceCode.js"></script>
          <script src="./js/search/search.js"></script>
          <script src="./js/search/lunr.min.js"></script>
          <script src="./js/search/search-lunr.js"></script>
          <script src="./js/search/search_index.js"></script>
       <script src="./js/lazy-load-graphs.js"></script>


    </body>
</html>
