language: node_js
node_js:
- stable
sudo: false
matrix:
  fast_finish: true
cache:
  directories:
  - node_modules
branches:
  except:
  - gh-pages
git:
  depth: 1
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- sleep 3
- npm i -g typescript@2.7.2
install:
- npm install
addons:
  firefox: latest
after_success:
- openssl aes-256-cbc -K $encrypted_5e96d350c582_key -iv $encrypted_5e96d350c582_iv
  -in build/docs/docs_rsa.enc -out build/docs/docs_rsa -d
- chmod 0600 build/docs/docs_rsa
- eval "$(ssh-agent -s)"
- ssh-add build/docs/docs_rsa
- npm i -g @compodoc/compodoc
- bash ./build/docs/publish-docs.sh
before_deploy:
- tsc ./build/prepare-npm-publish.ts
- node ./build/prepare-npm-publish.js
- tsc index.ts --declaration --target es5 --module commonjs
deploy:
  skip_cleanup: true
  provider: npm
  email: dvabuzyarov@gmail.com
  api_key:
    secure: n/CxBO0Vu60l20ENiR5hPcUCgGOOaGZlvsGOEnUmUQNyuUymco8zaXBuQ0L1RKgCXK/ixyuffHL14dOS5A3DSstRT9Ja0cnDtGUpKfCkdg8RtPgHyEwuRNf3KJrx0jnJcVTq5qYQ1VkStg5Hq7KUmHwyEaPp1OABSx+LvcIiVanPr8ofTOPEHDCoRbZsL7fwDITFArOYNbQQO+zAWRWKd66UzUUJNrYr2OlfGDooCIhV4Hn5FT64Br7c19CUYdxh7oDgA7gMRIa0KRXNwFt/z29ZZNr/jTOjquZTJS03w29fR8q3bncaCJsO6dXIAgngsxEpW3lvbQedUiuIN6gza6VFxz0dfbBoKesZmAU8OgZg02GtWVe6bZaPCX7p3vL32A7XCY54dvL06xWji1eA3gczy7AOl2z0c8H7ONp+uCN57sKuGQaGtIgIx6Br+r3vdf/lHAWghPY9kvL8adUVlaQPCVLTLZ+nMRNK031kt2iF49bp1Kl69TAvOJvfK7AKMfJrQpflioLSoaoTmFQQTfYgFkXV1oTF471E0Q/pL+CV4M6lsWIIT0cGGdCm9TL/84xeNpN5RYM2zfOMI/J6qYDk4hrw0w2XjcJ34BEc7sKpiRF0NplhNwux4U+FjSKmjURvEMFinzU1feaMXF4abmuhmSYrrqFxx+pRTShQxHo=
  on:
    tags: true
    repo: dvabuzyarov/moq.ts
